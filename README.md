# DaysOfJFE

最新**垃圾代码**力作.里面的一些功能可能是用了一些奇奇怪怪的方法实现的，大佬要喷轻点
同时可能有部分我不再使用的代码没删掉，无视即可

## 简述

期末大作业要求写个小游戏，所以就做了这么一个**视觉小说**，不过跟我最初的白日梦有着较大的差距，怎么说，有一些失败

我也没怎么学过 C++，问就是 AI 教的，你问我什么是模板，不好意思，只知道用.一开始学校要求用 [EasyX](https://easyx.cn/)，不过 EaxyX 不带抗锯齿，所以就直接使用 GDI+ 进行绘图，只用了 EasyX 消息功能和双缓冲

还有这 C/C++的头文件分离搞得我头大，一开始我除了 main.cpp 其他全是.h，导致了一些奇奇怪怪的报错.分离之后又有一堆奇奇怪怪的报错，C/C++太灵活了

## 基本框架

自己根据 WPF 和 Web 开发的一些概念进行搭建了一个十分简陋的框架：`WindowManager` 负责管理所有 `WindowPanel`（所有窗口的基类），每个 `WindowPanel` 都具有 `ForegroudControls`,`MiddlegroundControls`,`BackgroundControls` 三个控件层，负责管理基于`Controls`类的控件.每个控件都有一些基本属性与函数，如 `FontSize`、`Width`、`Height`以及`Draw()` 等.

除此之外，还有

- 负责提供公共方法的 IGlobalEvent
- 负责解析 YAML 格式剧本的 GameScript（基于[yaml-cpp](https://github.com/jbeder/yaml-cpp)）
- 具有 SFX、VOICE、BGM 三通道的 MusicPlayer（基于[BASS](https://www.un4seen.com/)）
- 提供工具函数的 Utils

## 部分运行流程

main.cpp 负责 `WindowManger`、`IGlobalEvernt` 以及窗口的初始化，然后把窗口添加到 `WindowManger` 中.其中每个窗口内部自己回把所有控件添加到指定层，并且 main 函数调用 `BeginBatchDraw()`以实现双缓冲.

随后就是使用`peekmessage()`进行消息监听,只监听鼠标消息和键盘消息，并且排除鼠标移动消息.监听到的消息会传递给`WindowManger`分发至活跃的绘图窗口，绘图窗口再根据事件触发控件或者自己内部的函数.

判断是否点击控件用的是简单的矩形判断，并且`Visibility`为`false`的控件不会参与判断.

完成触发操作后就会进行重绘，因为能力有限，所以重绘十分简单粗暴，`cleardevice()`后活跃窗口中所有 `Visibility` 为 `true`的控件都会被依照添加顺序和层次等级，按照`ForegroudControls`,`MiddlegroundControls`,`BackgroundControls`的层次顺序，先添加的控件先绘制的规则进行重绘.

## 已有的窗口

- GameWindow
  游戏的窗口
- HomeWindow
  进入游戏后的界面
- LoadingWindow
  提供了图片淡入淡出功能的窗口
- LoadSceneWindow
  提供跳转至对应 Scene 功能的窗口
- SettingWindow
  虚假的设置窗口

## 已有的控件

- PrimaryButton
- ClickPaper
  一个只有长宽但是没然后绘图的控件，用于方便的设置某一块区域的点击事件
- ImageContainer
  图像容器，仿照 CSS 提供了 contain、cover、fill 等属性
- OutlineText
  描边文本，一开始对话框用的是这个显示文字，回来改成另外一个样式后直接使用 TextBlock 了，内部都提供了逐字显示动画效果
- TextBlock
  文本块，功能和 Outline 一样，只是为了适配新的对话框不描边了
- TitleTransition
  标题过渡窗口，名义是过渡，其实就是个背景是黑色然后中间显示个大字体的东西.一开始想做成「苍之彼方四重奏」那样，可惜不太合适

## 其他说明

为了实现一些触发操作，程序实现了一个非常简陋的`Hook`（可能也叫不上`Hook`）.比如每个窗口都有对于鼠标右键、键盘按下的`Hook`.其他地方也会有一些奇奇怪怪的`Hook`

`GameScript` 只是解析剧本至对应结构中的，真正实现由 `GameWindow` 窗口完成，比如 `GameWindow` 实现了一个简易的命令系统，允许在 YAML 格式剧本中写一些命令：

- 切换背景
- 播放音频（有 VOICE、BGM、SFX 三个通道）
- 角色高亮/隐藏
- 显示标题
- 跳转场景(Scene)

## 艺术方面

我个人比较反对 AI 完全参与到艺术创造当中，艺术应该是**以人为本**.所以本项目不会出现 AI 配音、AI 插画.

一开始想过使用其他 Gal 的 BGM，但是感觉我的作品配不上这些充满回忆与感情的音乐，所以最终也没使用（相当于 `MusicPlayer` 彻底变成摆设了……）

至于对话框，是对着「苍之彼方四重奏」的对话框抄的（但我也没实现独白时人物姓名框隐藏的功能……）

剧本里除了第 5 章我都不满意，但是，写不出呀，终究变成了一个“作业”

我很喜欢「苍之彼方四重奏」「CloverDays」的艺术效果的，只可惜能力有限，而且剧本也配不上

可以的话，我还是想以「会长是女仆大人」「路人女主的 CTF 养成方法」「这个网安协会大有问题」「中二病也要打 CTF」等等标题，满足我的内心

## 借物表

| 名称                             | 出处                                     |
| -------------------------------- | ---------------------------------------- |
| クゥクゥちゃん\_91289326         | https://www.pixiv.net/artworks/91289326  |
| 大ちゃん(等身練習)\_129022253_p1 | https://www.pixiv.net/artworks/129022253 |
| 寄り道しちゃう？\_84040068       | https://www.pixiv.net/artworks/84040068  |
| 涼宮ハルヒ\_110906004            | https://www.pixiv.net/artworks/110906004 |

## 后言

其实我一开始是想做一个私货满满的**视觉小说**的，不过嘛，真让我写起来，又是另外一回事。

写不出「CLANND」「LB」「AB」那样有感人的剧情

写不出「请问您今天要来点兔子吗」「幸运星」「珈百璃的堕落」「GJ 部」那样的日常

写不出「学生会的一己之见」「这个勇者明明超强却过分慎重」那样搞笑又有些许心酸的故事

写不出「擅长捉弄的高木同学」「关于我无意间被隔壁的天使逐渐养成废人这件事」那样甜甜的恋情

写不出「龙与虎」「我的青春恋爱物语果然有问题」「我的妹妹不可能这么可爱」那样的高中物语

写不出「苍之彼方四重奏」那样轰轰烈烈的空竟

没有常磐华乃、和泉纱雾的画技，没有羽岛伊月的写作能力……

所谓视觉小说，应该是能给人丰富的情感体验，只可惜，这个作品更多称为“一次作业”
